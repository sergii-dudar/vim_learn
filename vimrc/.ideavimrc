" ================================ info ================================"
" .ideavimrc i sa configuration file for IdeaVim plugin. It uses"
"   the same commands as the original .vimrc configuration."
" You can find a list of commands here: https://jb.gg/h38q75"
" Find more examples here: https://jb.gg/share-ideavimrc"
" plugin instuctions: https://github.com/JetBrains/ideavim/wiki/IdeaVim-Plugins"

" Jetbrains Actions Mappings, all list of possible idea actions exec command :actionlist"

" In my case I prefer to use Control over Alt, so I rebinded some of the shortcuts"
" <EditorUp> -> <c-k> // Useful for navigating in pop ups"
" <EditorDown> -> <c-j> // Useful for navigating in pop ups"
" <ActivateProjectToolWindow> -> <c-e> // Go to project explorer"
" <HideActiveWindow> -> <c-h> // Minimize window"
" <NewElement> -> <c-n> // Useful for NerdTree"
" <ShowPopupMenu> -> <c-m> // Useful in many situations (NerdTree, editor...). It acts as a right click"
" <PreviousTab> -> <a-h> // Useful for switching tabs in terminal"
" <NextTab> -> <a-l> // Useful for switching tabs in terminal"
" <NextSplitter> -> <c-w> // Useful for switching windows"
" <PrevSplitter> -> <c-W> // Useful for switching windows"
" <EditorScrollDown> -> <c-J> // Useful for scrolling"
" <EditorScrollUp> -> <c-K> // Useful for scrolling"
" ============================== basic pre configuration ==========================="

noremap <Up> <Nop>
noremap <Down> <Nop>
noremap <Left> <Nop>
noremap <Right> <Nop>

" repeat comand for visually selected block"
vnoremap . :norm! .<CR>

" ================================ basic settings ================================="
set number relativenumber
set idearefactormode=keep

set ideajoin
set incsearch
set scrolloff=5
set hlsearch
set ignorecase
set smartcase
set ideaput

" ================================ space as leader ================================="
nnoremap <SPACE> <Nop>
let mapleader = " "

" ================================ plugins https://jb.gg/ideavim-plugins ================================="
set surround            "https://github.com/tpope/vim-surround"
set multiple-cursors    "https://github.com/terryma/vim-multiple-cursors"
set easymotion          "https://github.com/easymotion/vim-easymotion"
set commentary          "https://github.com/tpope/vim-commentary"
set highlightedyank     "https://github.com/machakann/vim-highlightedyank/blob/master/doc/highlightedyank.txt"
set NERDTree            "https://github.com/JetBrains/ideavim/wiki/NERDTree-support"
set exchange            "https://github.com/tommcdo/vim-exchange/blob/master/doc/exchange.txt"
set textobj-indent      "https://www.seanh.cc/2020/08/08/vim-indent-object/, https://github.com/michaeljsmith/vim-indent-object/blob/master/doc/indent-object.txt"

"========================================================================================"
"========================================================================================"
"===============================VIM KEY Mapping ========================================="
"========================================================================================"
"========================================================================================"

" (Move to line start/end)"
map H ^
map L $

" (Move between blocks)"
map J }
map K {

" (Block ident)"
vmap < <gv
vmap > >gv

"(Copy to system clipboard)"
"vmap <C-S-c> +y "

"================================ NERDTree config ================================="
map <C-p> :NERDTree<CR>
let g:NERDTreeMapActivateNode='l'
let g:NERDTreeMapJumpParent='h'
nnoremap <leader>ft :NERDTree<CR>
nnoremap <leader>fT :NERDTreeFind<CR>

"================================ highlightedyank config ================================="
"let g:highlightedyank_highlight_color = "rgba(172, 205, 218, 1)""
let g:highlightedyank_highlight_duration = "300"

"================================ vim-multiple-cursors config ================================="
nmap <leader>n <Plug>NextWholeOccurrence
xmap <leader>n <Plug>NextWholeOccurrence
nmap g<C-n> <Plug>NextOccurrence
xmap g<C-n> <Plug>NextOccurrence
xmap <C-x> <Plug>SkipOccurrence
xmap <C-p> <Plug>RemoveOccurrence

"================================ easymotion ================================="
map <leader>k <Plug>(easymotion-s)
map <leader>j <Plug>(easymotion-f)

"================================ macro ================================="
nnoremap R @q " R to execute q macro

"================================ tmpl config ================================="
" TODO:"

"================================ tmpl config ================================="
" TODO:"

"========================================================================================"
"========================================================================================"
"========================Idea Custom Actions Mapping ===================================="
"========================================================================================"
"========================================================================================"


"======================================  Run & Debug ==============================================="
nmap <leader>a      <Action>(Run)
nmap <leader>q      <Action>(Stop)

nnoremap <leader>rd <Action>(ChooseDebugConfiguration)
nnoremap <leader>rD <Action>(ChooseRunConfiguration)
nnoremap <leader>rp <Action>(Debug)
nnoremap <leader>rP <Action>(Run)
nnoremap <leader>rc <Action>(DebugClass)
map <leader>rr <Action>(RunClass)
nnoremap <leader>rr <Action>(Rerun)
nnoremap <leader>rs <Action>(Stop)
nnoremap <leader>ra <Action>(RunAnything)
map <leader>rc <Action>(ContextRun)
map <leader>rt <Action>(RunTests)
nmap <leader>tf <Action>(RerunFailedTests)

"======================================  Debugger ==============================================="
noremap <leader>de <action>(QuickEvaluateExpression)
noremap <leader>dE <action>(EvaluateExpression)
vnoremap <leader>di <Action>(Debugger.AddInlineWatch)
vnoremap <leader>dw <Action>(Debugger.AddToWatch)
nnoremap <leader>db <Action>(EditBrakpoint)
nnoremap <leader>dt <Action>(ToggleLineBreakpoint)
nnoremap <leader>dr <Action>(Debugger.RemoveAllBreakpointsInFile)
nnoremap <leader>dR <Action>(Debugger.RemoveAllBreakpoints)
nnoremap <leader>dm <Action>(XDebugger.MuteBreakpoints)
nnoremap <leader>dc <Action>(ForceRunToCursor)
nnoremap <C-j> <Action>(StepOver)
nnoremap <C-k> <Action>(Resume)
nnoremap <C-h> <Action>(StepOut)
nnoremap <C-l> <Action>(ForceStepInto)








"======================================= Code ================================================="
nmap <leader>i      <Action>(Generate)
nmap <leader>o      <Action>(OptimizeImports)
"nmap <leader>n      <Action>(NewClass)"
nmap <leader>r      <Action>(ReformatCode)

map <leader>im <Action>(ImplementMethods)
nmap \\ic <Action>(InspectCode)
map <leader>om <Action>(OverrideMethods)
nnoremap <Leader>sw <Action>(SurroundWith)

nmap <leader>cs     <Action>(QuickChangeScheme)

nmap <leader>s      <Action>(GlobalSettings)

"======================================= Refactoring ================================================="
IntroduceActionsGroup
IntroduceConstant                                  <M-A-C>
IntroduceField                                     <M-A-F>
IntroduceFunctionalParameter                       <M-A-S-P>
IntroduceFunctionalVariable
IntroduceParameter                                 <M-A-P>
IntroduceParameterObject
IntroduceVariable 
map <leader>re <Action>(Refactorings.QuickListPopupAction)
map <leader>uw <Action>(Unwrap)
map <leader>sw <Action>(SurroundWith)
map <leader>sd <Action>(SafeDelete)
map <leader>oi <Action>(OptimizeImports)

nnoremap <Leader>cr <Action>(CopyReference)
nnoremap <Leader>em <Action>(ExtractMethod)

" Join Lines"
map <leader>j <Action>(EditorJoinLines)
EditorSortLines
EditorSplitLine  

map gr <Action>(RefactoringMenu)
map gH <Action>(QuickActions)
map ga <Action>(ShowIntentionActions)
nnoremap == :action ReformatCode \| action OptimizeImports<CR>

"======================================= Rename ================================================="
nnoremap <Leader>me <Action>(RenameElement)
nnoremap <Leader>mf <Action>(RenameFile)
nnoremap <Leader>fc <Action>(ReformatCode)

"======================================= New ... ================================================="
map <leader>nn <Action>(NewElement)
map <leader>nd <Action>(NewDir)
map <leader>nf <Action>(NewFile)
map <leader>np <Action>(NewProject)
map <leader>nm <Action>(NewModule)



"======================================= Comment ================================================="
map <leader>c <Action>(CommentByLineComment)
map <leader>C <Action>(CommentByBlockComment)
nnoremap <Leader>fd <Action>(FixDocComment) "https://blog.jetbrains.com/idea/2012/09/fix-doc-comment-action-is-available/"



"======================================= Show ================================================="

nmap \\o <Action>(SelectAllOccurrences)

nmap <leader>hc <Action>(CallHierarchy)
nmap <leader>hm <Action>(MethodHierarchy)
nmap <leader>ht <Action>(TypeHierarchy)
nmap <Leader>n <Action>(LocalHistory.ShowHistory)
xmap <Leader>n <Action>(LocalHistory.ShowSelectionHistory)
map <leader>sf <Action>(ShowFilePath)
map <leader>si <Action>(SelectIn)
map \\sw <Action>($SearchWeb)
map <leader>fu <Action>(FindUsages)
map gf <Action>(ShowUsages)

map <leader>hl <Action>(HighlightUsagesInFile)
map <leader>qp <Action>(QuickPreview)
map <leader>qd <Action>(QuickDefinition)
map <leader>qD <Action>(QuickTypeDefinition)

"======================================= View mode ================================================="
map <leader>vf <Action>(ToggleFullScreen)
map <leader>vv <Action>(ToggleDistractionFreeMode)
map <leader>vp <Action>(TogglePresentationMode)

"======================================= Navigation ================================================="
map <M-k> <Action>(MoveLineUp)
map <M-j> <Action>(MoveLineDown)

noremap <Leader><Leader> <Action>(SearchEverywhere)
nmap <leader>fr <Action>(Replace)
nmap <leader>fp <Action>(FindInPath)
noremap <leader>sf <Action>(Find)
noremap <leader>sR <Action>(ReplaceInPath)
noremap <leader>sc :nohlsearch<CR>

nnoremap <leader>fb <Action>(Switcher)
nnoremap <leader>ff <Action>(GotoFile)
nnoremap <leader>fc <Action>(GotoClass)
nnoremap <leader>fs <Action>(GotoSymbol)
nnoremap <leader>fa <Action>(GotoAction)
nnoremap <leader>fd <Action>(GotoDatabaseObject)

nmap <leader>gp <Action>(GotToSuperMethod)
map gT <Action>(TextSearchAction)
map gd <Action>(GotoDeclaration)
map gI <Action>(QuickImplementations)

map gD <Action>(GotoTypeDeclaration)
nnoremap gi <Action>(GotoImplementation)
nnoremap gs <Action>(GotoSuperMethod)
map gt <Action>(GotoTest)
nmap <Leader>j <Action>(ShowNavBar)
noremap  <Leader>k <Action>(KJumpAction)
nmap [u <Action>(GotoPrevElementUnderCaretUsage)
nmap ]u <Action>(GotoNextElementUnderCaretUsage)
nmap [o <Action>(PreviousOccurence)
nmap ]o <Action>(NextOccurence)
nmap ]c <Action>(JumpToNextChange)
nmap <leader>sl <Action>(RecentLocations)
nmap <leader>sd <Action>(QuickJavaDoc)
nmap <leader>se <Action>(ShowErrorDescription)
nmap <leader>sf <Action>(RecentFiles)
nmap <leader>sc <Action>(RecentChangedFiles)

nmap <leader>gb <Action>(Back)
nmap <leader>gc <Action>(VcsShowPrevChangeMarker)
nmap <leader>ge <Action>(JumpToLastChange)
nmap <leader>gf <Action>(Forward)
nmap <leader>gm <Action>(MethodDown)
nmap <leader>gn <Action>(VcsShowNextChangeMarker)

nmap <leader>gu <Action>(MethodUp)
nmap <leader>gw <Action>(GotoPreviousError)
nmap <leader>gx <Action>(GotoNextError)

"======================================= Project Tree ================================================="
nmap <leader>e      <Action>(ActivateProjectToolWindow)
nmap <leader>e      <Action>(SelectInProjectView)



"======================================= Git ================================================="
nmap <leader>m      <Action>(Git.Menu)
nmap <leader>ca <Action>(Annotate)

"======================================= Tabs ================================================="
" (Move between panes top/bottom/left/right)"
map <C-k> <C-w>k
map <C-j> <C-w>j
map <C-h> <C-w>h
map <C-l> <C-w>l

nmap <Tab>     <Action>(NextTab)
nmap <S-Tab>   <Action>(PreviousTab)
nmap <leader>1 <Action>(GoToTab1)
nmap <leader>2 <Action>(GoToTab2)
nmap <leader>3 <Action>(GoToTab3)
nmap <leader>4 <Action>(GoToTab4)
nmap <leader>5 <Action>(GoToTab5)
nmap <leader>6 <Action>(GoToTab6)
nmap <leader>7 <Action>(GoToTab7)
nmap <leader>8 <Action>(GoToTab8)
nmap <leader>9 <Action>(GoToTab9)
map <leader>0 <Action>(GoToLastTab)

map <leader>sh <Action>(MoveTabLeft)
map <leader>sj <Action>(MoveTabDown)
map <leader>sk <Action>(MoveTabUp)
map <leader>sl <Action>(MoveTabRight)
map <leader>p <Action>(PinActiveEditorTab)

nnoremap tm <Action>(MoveEditorToOppositeTabGroup)
nnoremap to <Action>(OpenEditorInOppositeTabGroup)

nmap <leader>wh <Action>(CloseAllToTheLeft)
nmap <leader>wl <Action>(CloseAllToTheRight)
nmap <leader>wr <Action>(ReopenClosedTab)
nmap <leader>wc <Action>(HideAllWindows)

" (Pane vertically split/horizontally split/close)"
map <leader>sH <Action>(SplitHorizontally)
map <leader>sV <Action>(SplitVertically)
nmap <leader>wu <Action>(Unsplit)
map <C-p> <Action>(JumpToLastWindow)
map <M-i> <Action>(PrevSplitter)
map <M-o> <Action>(NextSplitter)

nnoremap <leader>wc <Action>(ActivateCommitToolWindow)
nnoremap <leader>wd <Action>(ActivateDebugToolWindow)
nnoremap <leader>wr <Action>(ActivateRunToolWindow)
nnoremap <leader>wg <Action>(ActivateVersionControlToolWindow)
nnoremap <leader>wm <Action>(ActivateMavenToolWindow)

nmap <leader>wk <Action>(StretchSplitToTop)
nmap <leader>wj <Action>(StretchSplitToBottom)
nmap <leader>wh <Action>(StretchSplitToLeft)
nmap <leader>wl <Action>(StretchSplitToRight)
map <leader>wm <Action>(MaximizeEditorInSplit)
map <leader>wu <Action>(UnsplitAll)
nnoremap zn <Action>(ToggleDistractionFreeMode)
"======================================= Editor ================================================="
nmap <leader>cc     <Action>(CloseEditor)
nmap <leader>cp     <Action>(CloseProject)

map <leader>xx <Action>(CloseContent)
map <leader>xa <Action>(CloseAllEditors)
map <leader>xo <Action>(CloseAllEditorsButActive)
map <leader>xp <Action>(CloseAllUnpinnedEditors)

nmap <leader>h      <Action>(HideActiveWindow)

"======================================= Menu ================================================="
map <leader>mm <Action>(MainMenu)
map <leader>ma <Action>(AnalyzeMenu)
map <leader>mb <Action>(BuildMenu)
map <leader>mc <Action>(CodeMenu)
map <leader>mf <Action>(FindMenuGroup)
map <leader>mg <Action>(GoToMenu)
map <leader>ms <Action>(ScopeViewPopupMenu)
map <leader>mt <Action>(EditorTabPopupMenu)
map <leader>mw <Action>(ToolWindowsGroup)

"======================================= Scroll ================================================="
nmap <leader>eh <Action>(EditorScrollLeft)
nmap <leader>ej <Action>(EditorScrollDown)
nmap <leader>ek <Action>(EditorScrollUp)
nmap <leader>el <Action>(EditorScrollRight)

"======================================= (Code fold/expand) ================================================="
map zm <Action>(CollapseRegion)
map za <Action>(ExpandRegion)
map zM <Action>(CollapseAllRegions)
map zR <Action>(ExpandAllRegions)
map zz <Action>(ExpandCollapseToggleAction)

"======================================= Terminal ================================================="
nmap <leader>tt <Action>(ActivateTerminalToolWindow)
nmap <leader>tc <Action>(Terminal.OpenInTerminal) " OpenTerminal with current dir"

"======================================= Zen ================================================="
map <leader>z <Action>(ToggleZenMode)

"======================================= Project management ================================================="
map <leader>pr <Action>(ManageRecentProjects)
map <leader>pl <Action>(RecentProjectListGroup)
map <leader>px <Action>(CloseProject)

"======================================= bookmarks and buffer ================================================="
nnoremap <leader>bb <Action>(Bookmarks)
nnoremap <leader>bs <Action>(ShowBookmarks)
nnoremap <leader>bt <Action>(ToggleBookmark)
nnoremap <leader>bf <Action>(AddToFavorites)

"======================================= Vim RC ================================================="
nmap <leader>vr <Action>(IdeaVim.ReloadVimRc.reload)
nnoremap <leader>ve :e ~/.ideavimrc<CR>
